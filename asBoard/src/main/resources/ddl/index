-- 헤더 테이블: FARM_CODE 조건 검색 시 + USE_FLAG 항상 붙음
CREATE NONCLUSTERED INDEX IDX_HEADER_USE_FARM
ON wjlee.dbo.SF_TBL_AS_HEADER (USE_FLAG, FARM_CODE);

-- ✅ 목록 기준일로 자주 쓰는 REQ_DATE: 헤더 테이블
CREATE NONCLUSTERED INDEX IDX_HEADER_USE_REQDATE
ON wjlee.dbo.SF_TBL_AS_HEADER (USE_FLAG, REQ_DATE DESC);

-- 스케줄 테이블: PLAN_DATE 필터, 정렬에 필수
CREATE NONCLUSTERED INDEX IDX_SCHEDULE_PLAN_DATE
ON wjlee.dbo.SF_TBL_AS_SCHEDULE (PLAN_DATE);

-- 스케줄 테이블: COMPLETE_DATE 필터, 통계용
CREATE NONCLUSTERED INDEX IDX_SCHEDULE_COMPLETE_DATE
ON wjlee.dbo.SF_TBL_AS_SCHEDULE (COMPLETE_DATE);

-- 스케줄 테이블: 조인 기준
CREATE NONCLUSTERED INDEX IDX_SCHEDULE_ASID
ON wjlee.dbo.SF_TBL_AS_SCHEDULE (AS_ID);

-- 장비 테이블: 조인 기준
CREATE NONCLUSTERED INDEX IDX_EQUIP_ASID
ON wjlee.dbo.SF_TBL_AS_EQUIP (AS_ID);

-- 장비 테이블: 장비 통계용 + USE_FLAG 결합
CREATE NONCLUSTERED INDEX IDX_EQUIP_TABLE_USE
ON wjlee.dbo.SF_TBL_AS_EQUIP (TABLE_NAME, USE_FLAG);

-- 파일 테이블: 조인용
CREATE NONCLUSTERED INDEX IDX_FILE_ASID
ON wjlee.dbo.SF_TBL_AS_FILE (AS_ID);

-- 1) FUTURE_SCH/ANY_SCH: AS_ID별 PLAN_DATE 최솟값 TOP 1
CREATE NONCLUSTERED INDEX IX_SCH_ASID_PLAN
ON wjlee.dbo.SF_TBL_AS_SCHEDULE (AS_ID, PLAN_DATE)
INCLUDE (USE_FLAG, COMPLETE_DATE);


-- 2) 통계 APPLY: DONE_CNT, FIRST_PENDING_PLAN 계산용
CREATE NONCLUSTERED INDEX IX_SCH_ASID_COMPLETE
ON wjlee.dbo.SF_TBL_AS_SCHEDULE (AS_ID, COMPLETE_DATE)
INCLUDE (PLAN_DATE, USE_FLAG);


-- 3) 활성 일정 전용(필터 인덱스)
CREATE NONCLUSTERED INDEX IX_SCH_ACTIVE
ON wjlee.dbo.SF_TBL_AS_SCHEDULE (AS_ID, PLAN_DATE)
INCLUDE (COMPLETE_DATE)
WHERE USE_FLAG = '1';