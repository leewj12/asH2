<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.inpro.asBoard.user.UserMapper">

    <!-- 엔티티 매핑 -->
    <resultMap id="UserAccountMap" type="UserAccount">
        <id     property="userId"      column="USER_ID"/>
        <result property="username"    column="USERNAME"/>
        <result property="passwordHash" column="PASSWORD_HASH"/>
        <result property="roles"       column="ROLES"/>
        <result property="active"      column="ACTIVE"/>
        <result property="regDate"     column="REG_DATE"/>
    </resultMap>

    <!-- 1) 사용자 조회 (username) -->
    <select id="findByUsername" parameterType="string" resultMap="UserAccountMap">
        SELECT
        USER_ID, USERNAME, PASSWORD_HASH, ROLES, ACTIVE, REG_DATE
        FROM USERS
        WHERE USERNAME = #{username}
    </select>

    <!-- 2) 전체 사용자 수 -->
    <select id="countAll" resultType="int">
        SELECT COUNT(*) FROM USERS
    </select>

    <!-- 3) 사용자 등록 -->
    <insert id="insert" parameterType="UserAccount" useGeneratedKeys="true" keyProperty="userId">
        INSERT INTO USERS (USERNAME, PASSWORD_HASH, ROLES, ACTIVE)
        VALUES (#{username}, #{passwordHash}, #{roles}, #{active})
        <!-- REG_DATE 는 테이블 DEFAULT CURRENT_TIMESTAMP 사용 -->
    </insert>

</mapper>
