-- H2 schema for AS Board (MSSQL compatible)
-- If you run outside Spring with a plain H2 console, you can also do:
-- SET MODE MSSQLServer;

DROP TABLE IF EXISTS SF_TBL_AS_FILE;
DROP TABLE IF EXISTS SF_TBL_AS_SCHEDULE;
DROP TABLE IF EXISTS SF_TBL_AS_EQUIP;
DROP TABLE IF EXISTS SF_TBL_AS_HEADER;
DROP TABLE IF EXISTS USERS;

-- USERS
CREATE TABLE USERS (
  USER_ID       BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  USERNAME      VARCHAR(64)  NOT NULL UNIQUE,
  PASSWORD_HASH VARCHAR(200) NOT NULL,
  ROLES         VARCHAR(64)  NOT NULL,
  ACTIVE        BOOLEAN      NOT NULL DEFAULT TRUE,
  REG_DATE      TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- SF_TBL_AS_HEADER
CREATE TABLE SF_TBL_AS_HEADER (
  AS_ID        BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  FARM_CODE    VARCHAR(6)   NOT NULL,
  AS_TYPE      VARCHAR(64),
  REQ_USER     VARCHAR(32),
  AS_MANAGER   VARCHAR(32),
  REQ_DATE     TIMESTAMP,
  REG_DATE     TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UPD_DATE     TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  REQ_CONTENT  CLOB,
  AS_RESULT    CLOB,
  ETC          CLOB,
  STATUS_FLAG  VARCHAR(1) NOT NULL DEFAULT '1',
  USE_FLAG     VARCHAR(1) NOT NULL DEFAULT '1'
);

-- SF_TBL_AS_EQUIP
CREATE TABLE SF_TBL_AS_EQUIP (
  AS_EQUIP_ID  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  AS_ID        BIGINT NOT NULL,
  TABLE_NAME   VARCHAR(64),
  EQMNT_SEQ    CHAR(3),
  SUB_SEQ      CHAR(3),
  EQMNT_KIND   CHAR(3),
  EQMNT_NAME   VARCHAR(64),
  USE_DATE     TIMESTAMP,
  USE_FLAG     CHAR(1) NOT NULL DEFAULT '1',
  CONSTRAINT FK_AS_HEADER
    FOREIGN KEY (AS_ID) REFERENCES SF_TBL_AS_HEADER(AS_ID)
);

-- SF_TBL_AS_SCHEDULE
CREATE TABLE SF_TBL_AS_SCHEDULE (
  SCHEDULE_ID   BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  AS_ID         BIGINT NOT NULL,
  PLAN_DATE     TIMESTAMP NOT NULL,
  COMPLETE_DATE TIMESTAMP,
  AS_CONTENT    CLOB,
  REG_DATE      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UPD_DATE      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  USE_FLAG      CHAR(1) NOT NULL DEFAULT '1',
  CONSTRAINT FK_AS_SCHEDULE_HEADER
    FOREIGN KEY (AS_ID) REFERENCES SF_TBL_AS_HEADER(AS_ID)
);

-- SF_TBL_AS_FILE
CREATE TABLE SF_TBL_AS_FILE (
  FILE_ID       BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  AS_ID         BIGINT NOT NULL,
  ORIGINAL_NAME VARCHAR(256) NOT NULL,
  UUID_NAME     VARCHAR(256) NOT NULL,
  FILE_PATH     VARCHAR(512) NOT NULL,
  FILE_SIZE     INT,
  FILE_TYPE     VARCHAR(128),
  REG_DATE      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  USE_FLAG      CHAR(1) NOT NULL DEFAULT '1',
  CONSTRAINT FK_AS_FILE_HEADER
    FOREIGN KEY (AS_ID) REFERENCES SF_TBL_AS_HEADER(AS_ID)
);

-- Helpful indexes (optional but recommended)
CREATE INDEX IDX_SCHEDULE_ASID ON SF_TBL_AS_SCHEDULE(AS_ID);
CREATE INDEX IDX_EQUIP_ASID    ON SF_TBL_AS_EQUIP(AS_ID);
CREATE INDEX IDX_FILE_ASID     ON SF_TBL_AS_FILE(AS_ID);

-- ===== SF_TBL_FARM =====
CREATE TABLE SF_TBL_FARM (
  FARM_CODE        CHAR(6)      NOT NULL,
  FARM_NAME        VARCHAR(128) NOT NULL,
  AREA_CODE        VARCHAR(4)   NOT NULL,
  BIZ_CODE         VARCHAR(16),
  FARMER_NAME      VARCHAR(32),
  PHONE_NUMB       VARCHAR(24),
  CELL_PHONE       VARCHAR(24),
  EMAIL_ADDR       VARCHAR(128),
  ZIP_CODE         CHAR(5),
  FARM_ADDR1       VARCHAR(256),
  FARM_ADDR2       VARCHAR(256),
  FARM_INFO_FLAG   CHAR(1)      NOT NULL DEFAULT '0',
  MAIN_HOST_ADDR   VARCHAR(128) NOT NULL DEFAULT 'dbos.co.kr',
  MAIN_HOST_PORT   INT          NOT NULL DEFAULT 80,
  USE_FLAG         CHAR(1)      NOT NULL DEFAULT '0',
  USE_DATE         TIMESTAMP    NOT NULL,
  UPD_FLAG         CHAR(1)      NOT NULL DEFAULT '0',
  UPD_DATE         TIMESTAMP    NOT NULL,
  PASS_WORD        VARCHAR(4),
  CCTV_USE         CHAR(1)      NOT NULL DEFAULT '0',
  CCTV_KIND        CHAR(3),
  CCTV_ADDR        VARCHAR(255),
  CCTV_ID          VARCHAR(255),
  CCTV_PW          VARCHAR(32),
  ORDER_YN         CHAR(1)      NOT NULL DEFAULT 'Y',
  COUNTRY          CHAR(2),
  SUB_HOST_ADDR    VARCHAR(128),
  SUB_HOST_PORT    INT,
  MIN_TEMP_SPR     DECIMAL(10,1) NOT NULL DEFAULT -99,
  MAX_TEMP_SPR     DECIMAL(10,1) NOT NULL DEFAULT  99,
  MIN_TEMP_SUM     DECIMAL(10,1) NOT NULL DEFAULT -99,
  MAX_TEMP_SUM     DECIMAL(10,1) NOT NULL DEFAULT  99,
  MIN_TEMP_AUT     DECIMAL(10,1) NOT NULL DEFAULT -99,
  MAX_TEMP_AUT     DECIMAL(10,1) NOT NULL DEFAULT  99,
  MIN_TEMP_WIN     DECIMAL(10,1) NOT NULL DEFAULT -99,
  MAX_TEMP_WIN     DECIMAL(10,1) NOT NULL DEFAULT  99,
  FEED_PHONE       VARCHAR(11),
  TEMP_VENTIL_FLAG CHAR(1)       DEFAULT '0',
  VENTIL_ON_TEMP   DECIMAL(4,1)  DEFAULT 30,
  ORDER_TYPE       VARCHAR(16)   DEFAULT 'none',
  TOWN_CODE        CHAR(10)     NOT NULL DEFAULT '0000000000',
  CITY_CODE        CHAR(3)      NOT NULL DEFAULT '000',
  NEWS_KEYWORD     VARCHAR(64)  NOT NULL DEFAULT '축산 | inpro | 인프로',
  STOCK_CODE       VARCHAR(16),
  DISPLAY_FLAG     CHAR(1)      NOT NULL DEFAULT 'N',
  DISPLAY_ON_TIME  CHAR(4)      NOT NULL DEFAULT '0700',
  DISPLAY_OFF_TIME CHAR(4)      NOT NULL DEFAULT '1800',
  BIZ_YMD          CHAR(8),
  BIZ_FLAG         CHAR(1),
  SEARCH_CODE      VARCHAR(10),
  COM_FLAG         CHAR(1)       DEFAULT '0',
  DASH_WEATHER_KIND VARCHAR(16) NOT NULL DEFAULT 'kma',
  KIND_LIVESTOCK   CHAR(2),
  SRA_INDV_AMNNO   VARCHAR(20),
  RESER_FLAG       CHAR(1)       DEFAULT '0',
  EKAPE_FLAG       CHAR(1)       DEFAULT '0',
  EKAPE_NAME       VARCHAR(16),
  EKAPE_PHONE      VARCHAR(16),
  EKAPE_FARM       VARCHAR(16),
  WEIGHT_FLAG      CHAR(1),
  STANDARD_DATE    VARCHAR(32),
  FARM_MEMO        VARCHAR(256),
  REGION_NAME      VARCHAR(32)   DEFAULT '',
  PROJECT_NAME     VARCHAR(32)   DEFAULT '',
  SERVICE_DATE     VARCHAR(16)   DEFAULT '',
  REGION_CODE      CHAR(10),
  DEV_FLAG         CHAR(1),
  CONSTRAINT PK_SF_TBL_FARM PRIMARY KEY (FARM_CODE)
);

-- ===== SF_TBL_EQMNT =====
CREATE TABLE SF_TBL_EQMNT (
  FARM_CODE        CHAR(6)    NOT NULL,
  EQMNT_SEQ        CHAR(3)    NOT NULL,
  EQMNT_KIND       CHAR(3)    NOT NULL,
  EQMNT_NAME       VARCHAR(64),
  TOTAL_VALUE      INT,
  MIN_VALUE        INT,
  STOCK_CODE       CHAR(3),
  STOCK_KIND       CHAR(3),
  STOCK_KIND_NAME  VARCHAR(32),
  STOCK_COUNT      INT,
  TML_CODE         VARCHAR(20),
  TML_UPDATE_DATE  CHAR(8)    NOT NULL DEFAULT '29991231',
  TML_STATUS_REQ   CHAR(1)    NOT NULL DEFAULT 'N',
  TML_DATA_RESET   CHAR(1)    NOT NULL DEFAULT 'N',
  TML_POWER_RESET  CHAR(1)    NOT NULL DEFAULT 'N',
  TML_ZERO_SET     CHAR(1)    NOT NULL DEFAULT 'N',
  TML_REQ_TERM     INT        NOT NULL DEFAULT 30,
  TML_CHECK_FLAG   CHAR(1)    NOT NULL DEFAULT '0',
  USE_FLAG         CHAR(1)    NOT NULL DEFAULT '0',
  USE_DATE         TIMESTAMP  NOT NULL,
  UPD_FLAG         CHAR(1)    NOT NULL DEFAULT '0',
  UPD_DATE         TIMESTAMP  NOT NULL,
  TML_INTERVAL     INT        DEFAULT 60,
  TML_SEND_FLAG    INT        DEFAULT 0,
  TML_LOCAL_IP     VARCHAR(64),
  TML_LOCAL_PORT   INT,
  TML_LOCAL_PATH   VARCHAR(128),
  FEED_COMP        VARCHAR(10),
  FEED_PROD        VARCHAR(30),
  FEED_MIN_ORDER   INT,
  FEED_MAX_ORDER   INT,
  TML_RUN_MODE     CHAR(1)    NOT NULL DEFAULT '0',
  HW_VERSION       VARCHAR(3)  DEFAULT '100',
  SW_VERSION       VARCHAR(3)  DEFAULT '100',
  CONSTRAINT PK_SF_TBL_EQMNT PRIMARY KEY (FARM_CODE, EQMNT_SEQ)
);

-- simplified indexes (MSSQL NONCLUSTERED equivalents)
CREATE INDEX IDX_EQMNT_01 ON SF_TBL_EQMNT (FARM_CODE, EQMNT_KIND, TML_CODE);
CREATE INDEX IDX_EQMNT_02 ON SF_TBL_EQMNT (TML_CODE);
CREATE INDEX IDX_EQMNT_03 ON SF_TBL_EQMNT (UPD_FLAG);

-- ===== SF_TBL_AIRCON =====
CREATE TABLE SF_TBL_AIRCON (
  FARM_CODE     CHAR(6)   NOT NULL,
  EQMNT_SEQ     CHAR(3)   NOT NULL,
  SUB_SEQ       CHAR(3)   NOT NULL DEFAULT '001',
  MOD_SEQ       CHAR(3)   NOT NULL,
  USE_FLAG      CHAR(1)   NOT NULL,
  USE_DATETIME  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UPD_FLAG      CHAR(1),
  UPD_DATETIME  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  AIRCON_NAME   VARCHAR(32),
  GROUP_CODE    CHAR(3)   DEFAULT '000',
  OPTION_1      VARCHAR(32),
  OPTION_2      VARCHAR(32),
  CONSTRAINT PK_SF_TBL_AIRCON PRIMARY KEY (FARM_CODE, EQMNT_SEQ, SUB_SEQ)
);